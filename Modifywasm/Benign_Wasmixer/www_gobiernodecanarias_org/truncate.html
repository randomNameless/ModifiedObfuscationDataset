<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>truncate.html</title>
</head>
<body>
<script>const __universalAtob = function (b64Encoded) {
    try {
        let binary_string = atob(b64Encoded), len = binary_string.length, bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes;
    } catch (err) {
        return new Uint8Array(global.Buffer.from(b64Encoded, 'base64'));
    }
};
const __forWasmBuffer = 'AGFzbQEAAAABCAJgAABgAAF/AiQDA2poeARoYWJzAAEDZnlpBm1rbHRjYgAAA3RhZwR5bmNtAAADAgEABAUBcAAECQUDAQABBxECBm1lbW9yeQIABGZpYWYAAwkKAQBBAQsEAwABAgoeARwAAkADQEECEQEARQ0BQQQRAABBAxEAAAwACwsL';
const __forWasmModule = new WebAssembly.Module((() => {
    try {
        let binary_string = atob(__forWasmBuffer), len = binary_string.length, bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes;
    } catch (err) {
        return new Uint8Array(global.Buffer.from(__forWasmBuffer, 'base64'));
    }
})());
const __ifWasmBuffer = 'AGFzbQEAAAABCAJgAABgAX8AAh8CA3NncQhudXhtaHFjdwAAA212YQh5ampsc2lheAAAAwIBAQQFAXAAAwgFAwEAAQcRAgZtZW1vcnkCAARnZHNtAAIJCQEAQQELAwACAQoOAQwAIAAEQBAABRABCws=';
const __ifWasmModule = new WebAssembly.Module((() => {
    try {
        let binary_string = atob(__ifWasmBuffer), len = binary_string.length, bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes;
    } catch (err) {
        return new Uint8Array(global.Buffer.from(__ifWasmBuffer, 'base64'));
    }
})());
const __callWasmBuffer = 'AGFzbQEAAAABBAFgAAACDwEDcGN4B3FkdG5oeHEAAAMCAQAEBQFwAAIHBQMBAAEHEQIGbWVtb3J5AgAEamNpaAABCQgBAEEBCwIBAAoJAQcAQQIRAAAL';
const __callWasmModule = new WebAssembly.Module((() => {
    try {
        let binary_string = atob(__callWasmBuffer), len = binary_string.length, bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes;
    } catch (err) {
        return new Uint8Array(global.Buffer.from(__callWasmBuffer, 'base64'));
    }
})());
const __wasmStringModules = ['AGFzbQEAAAAFg4CAgAABAAEGgYGAgAAWfwBBAQt/AEEEC38AQQoLfwBBEAt/AEHQAAt/AEHmAAt/AEH4AAt/AEGSAQt/AEGYAQt/AEGyAQt/AEG4AQt/AEHGAQt/AEHMAQt/AEHWAQt/AEHaAQt/AEHcAQt/AEHkAQt/AEHqAQt/AEHwAQt/AEH2AQt/AEGkAgt/AEGqAgsHxoGAgAAXBm1lbW9yeQIABWRhdGEwAwAFZGF0YTEDAQVkYXRhMgMCBWRhdGEzAwMFZGF0YTQDBAVkYXRhNQMFBWRhdGE2AwYFZGF0YTcDBwVkYXRhOAMIBWRhdGE5AwkGZGF0YTEwAwoGZGF0YTExAwsGZGF0YTEyAwwGZGF0YTEzAw0GZGF0YTE0Aw4GZGF0YTE1Aw8GZGF0YTE2AxAGZGF0YTE3AxEGZGF0YTE4AxIGZGF0YTE5AxMGZGF0YTIwAxQGZGF0YTIxAxULkYOAgAAWAEEBCwEAAEEECwQuLi4AAEEKCwRpbWcAAEEQCz8oJTVCJTVDdyU3Qy0lNUQlMkIlNUNzKiglM0QlNUNzKiUyMiU1QiU1RSUyMiU1RColMjIpJTNGJTVDcyopKgAAQdAACxQlNUNzKiU1QyUyRiUzRiU1Q3MqAABB5gALESU1Q3MqJTVDJTJGJTVDcyoAAEH4AAsZJTNDJTVDJTJGJTNGJTVDdyUyQiU1Q3MqAABBkgELBCUzRQAAQZgBCxklM0MlNUMlMkYlM0YlNUN3JTJCJTVDcyoAAEGyAQsEJTNFAABBuAELDCUzQ2ltZyU1Q3MqAABBxgELBCUzRQAAQcwBCwglNUNXJTJCAABB1gELAmcAAEHaAQsBAABB3AELByUzQyUyRgAAQeQBCwQlM0UAAEHqAQsEJTIwAABB8AELBCUzRQAAQfYBCy1IVE1MJTIwdGFnJTIwaXMlMjBub3QlMjB3ZWxsLWZvcm1lZCUyMCUzQSUyMAAAQaQCCwQlMkYAAEGqAgsKdW5kZWZpbmVkAA=='].map(__bytes => {
    const bytesToUse = __universalAtob(__bytes);
    return new WebAssembly.Instance(new WebAssembly.Module(bytesToUse));
});
const lS = (wI, pos, iWC) => {
    let __str = '';
    if (!Array.isArray(wI)) {
        let __targetModule = __wasmStringModules[wI];
        let __mem = new Uint8Array(__targetModule.exports.memory.buffer);
        const __stringKey = `data${ pos }`;
        let __start = __targetModule.exports[__stringKey] - 1;
        let __str = '';
        let i = __start;
        let __c = __mem[i++];
        while (!(parseInt(__c) & 128) && __mem[i]) {
            __str += __c;
            __c = String.fromCharCode(__mem[i++]);
        }
        __str += __c;
        __str = decodeURIComponent(__str.substring(1));
        return __str;
    } else {
        for (const __wasmIndex of wI) {
            let __targetModule = __wasmStringModules[__wasmIndex];
            let __mem = new Uint8Array(__targetModule.exports.memory.buffer);
            const __stringKey = `data${ pos }`;
            let __start = __targetModule.exports[__stringKey] - 1;
            let i = __start;
            let __c = __mem[i++];
            while (!(parseInt(__c) & 128) && __mem[i]) {
                __str += __c;
                __c = String.fromCharCode(__mem[i++]);
            }
            __str += __c;
        }
        __str = decodeURIComponent(__str.substring(1));
        return __str;
    }
};
function truncate(string, maxLength, options) {
    var EMPTY_OBJECT = {}, EMPTY_STRING = lS(0, 0), DEFAULT_TRUNCATE_SYMBOL = lS(0, 1), DEFAULT_SLOP = 10 > maxLength ? maxLength : 10, EXCLUDE_TAGS = [lS(0, 2)], items = [], total = 0, content = EMPTY_STRING, KEY_VALUE_REGEX = lS(0, 3), IS_CLOSE_REGEX = lS(0, 4), CLOSE_REGEX = lS(0, 5), SELF_CLOSE_REGEX = new RegExp(lS(0, 6) + KEY_VALUE_REGEX + CLOSE_REGEX + lS(0, 7)), HTML_TAG_REGEX = new RegExp(lS(0, 8) + KEY_VALUE_REGEX + IS_CLOSE_REGEX + lS(0, 9)), URL_REGEX = /(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)|((mailto:)?[_.\w\-]+@([\w][\w\-]+\.)+[a-zA-Z]{2,3})/g, IMAGE_TAG_REGEX = new RegExp(lS(0, 10) + KEY_VALUE_REGEX + IS_CLOSE_REGEX + lS(0, 11)), WORD_BREAK_REGEX = new RegExp(lS(0, 12), lS(0, 13)), matches = true, result, index, tail, tag, selfClose;
    function _removeImageTag(string) {
        var match = IMAGE_TAG_REGEX.exec(string), index, len;
        if (!match) {
            return string;
        }
        index = match.index;
        len = match[0].length;
        return string.substring(0, index) + string.substring(index + len);
    }
    function _dumpCloseTag(tags) {
        var html = lS(0, 14);
        (() => {
            const __callInstance2 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        tags.reverse().forEach(function (tag, index) {
                            (() => {
                                const __ifInstance0 = new WebAssembly.Instance(__ifWasmModule, {
                                    env: {
                                        impFunc1: () => {
                                            {
                                                html += lS(0, 15) + tag + lS(0, 16);
                                            }
                                        },
                                        impFunc2: () => {
                                        }
                                    }
                                });
                                const __exports = __ifInstance0.exports;
                                return __exports.data(-1 === EXCLUDE_TAGS.indexOf(tag) ? 1 : 0);
                            })();
                        });
                    }
                }
            });
            const __exports = __callInstance2.exports;
            return __exports.data();
        })();
        return html;
    }
    function _getTag(string) {
        var tail = string.indexOf(lS(0, 17));
        if (-1 === tail) {
            tail = string.indexOf(lS(0, 18));
            if (-1 === tail) {
                throw new Error(lS(0, 19) + string);
            }
        }
        return string.substring(1, tail);
    }
    function _getEndPosition(string, tailPos) {
        var defaultPos = maxLength - total, position = defaultPos, isShort = defaultPos < options.slop, slopPos = isShort ? defaultPos : options.slop - 1, substr, startSlice = isShort ? 0 : defaultPos - options.slop, endSlice = tailPos || defaultPos + options.slop, result;
        if (!options.truncateLastWord) {
            substr = string.slice(startSlice, endSlice);
            if (tailPos && substr.length <= tailPos) {
                position = substr.length;
            } else {
                while ((result = WORD_BREAK_REGEX.exec(substr)) !== null) {
                    if (result.index < slopPos) {
                        position = defaultPos - (slopPos - result.index);
                        if (result.index === 0 && defaultPos <= 1)
                            break;
                    } else if (result.index === slopPos) {
                        position = defaultPos;
                        break;
                    } else {
                        position = defaultPos + (result.index - slopPos);
                        break;
                    }
                }
            }
            (() => {
                const __ifInstance1 = new WebAssembly.Instance(__ifWasmModule, {
                    env: {
                        impFunc1: () => {
                            position--;
                        },
                        impFunc2: () => {
                        }
                    }
                });
                const __exports = __ifInstance1.exports;
                return __exports.data(string.charAt(position - 1).match(/\s$/) ? 1 : 0);
            })();
        }
        return position;
    }
    options = options || EMPTY_OBJECT;
    options.ellipsis = undefined !== options.ellipsis ? options.ellipsis : DEFAULT_TRUNCATE_SYMBOL;
    options.truncateLastWord = undefined !== options.truncateLastWord ? options.truncateLastWord : true;
    options.slop = undefined !== options.slop ? options.slop : DEFAULT_SLOP;
    while (matches) {
        matches = HTML_TAG_REGEX.exec(string);
        if (!matches) {
            if (total >= maxLength) {
                break;
            }
            matches = URL_REGEX.exec(string);
            if (!matches || matches.index >= maxLength) {
                content += string.substring(0, _getEndPosition(string));
                break;
            }
            (() => {
                const __forInstance0 = new WebAssembly.Instance(__forWasmModule, {
                    env: {
                        test: () => {
                            return matches ? 1 : 0;
                        },
                        update: () => {
                        },
                        body: () => {
                            {
                                result = matches[0];
                                index = matches.index;
                                content += string.substring(0, index + result.length - total);
                                string = string.substring(index + result.length);
                                matches = URL_REGEX.exec(string);
                            }
                        }
                    }
                });
                const __exports = __forInstance0.exports;
                return __exports.data();
            })();
            break;
        }
        result = matches[0];
        index = matches.index;
        if (total + index > maxLength) {
            content += string.substring(0, _getEndPosition(string, index));
            break;
        } else {
            total += index;
            content += string.substring(0, index);
        }
        (() => {
            const __ifInstance2 = new WebAssembly.Instance(__ifWasmModule, {
                env: {
                    impFunc1: () => {
                        {
                            (() => {
                                const __callInstance1 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            items.pop();
                                        }
                                    }
                                });
                                const __exports = __callInstance1.exports;
                                return __exports.data();
                            })();
                            selfClose = null;
                        }
                    },
                    impFunc2: () => {
                        {
                            selfClose = SELF_CLOSE_REGEX.exec(result);
                            (() => {
                                const __ifInstance3 = new WebAssembly.Instance(__ifWasmModule, {
                                    env: {
                                        impFunc1: () => {
                                            {
                                                tag = _getTag(result);
                                                (() => {
                                                    const __callInstance0 = new WebAssembly.Instance(__callWasmModule, {
                                                        env: {
                                                            impFunc: () => {
                                                                items.push(tag);
                                                            }
                                                        }
                                                    });
                                                    const __exports = __callInstance0.exports;
                                                    return __exports.data();
                                                })();
                                            }
                                        },
                                        impFunc2: () => {
                                        }
                                    }
                                });
                                const __exports = __ifInstance3.exports;
                                return __exports.data(!selfClose ? 1 : 0);
                            })();
                        }
                    }
                }
            });
            const __exports = __ifInstance2.exports;
            return __exports.data(lS(0, 20) === result[1] ? 1 : 0);
        })();
        (() => {
            const __ifInstance4 = new WebAssembly.Instance(__ifWasmModule, {
                env: {
                    impFunc1: () => {
                        {
                            content += selfClose[0];
                        }
                    },
                    impFunc2: () => {
                        {
                            content += result;
                        }
                    }
                }
            });
            const __exports = __ifInstance4.exports;
            return __exports.data(selfClose ? 1 : 0);
        })();
        string = string.substring(index + result.length);
    }
    (() => {
        const __ifInstance5 = new WebAssembly.Instance(__ifWasmModule, {
            env: {
                impFunc1: () => {
                    {
                        content += options.ellipsis;
                    }
                },
                impFunc2: () => {
                }
            }
        });
        const __exports = __ifInstance5.exports;
        return __exports.data(string.length > maxLength - total && options.ellipsis ? 1 : 0);
    })();
    content += _dumpCloseTag(items);
    (() => {
        const __ifInstance6 = new WebAssembly.Instance(__ifWasmModule, {
            env: {
                impFunc1: () => {
                    {
                        content = _removeImageTag(content);
                    }
                },
                impFunc2: () => {
                }
            }
        });
        const __exports = __ifInstance6.exports;
        return __exports.data(!options.keepImageTag ? 1 : 0);
    })();
    return content;
}
(() => {
    const __ifInstance7 = new WebAssembly.Instance(__ifWasmModule, {
        env: {
            impFunc1: () => {
                {
                    module.exports = truncate;
                }
            },
            impFunc2: () => {
            }
        }
    });
    const __exports = __ifInstance7.exports;
    return __exports.data(typeof module !== lS(0, 21) ? 1 : 0);
})();</script>
</body>
</html>
